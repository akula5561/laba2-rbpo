from pathlib import Path

readme_content = """#  Library Management System

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π.  
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∞–≤—Ç–æ—Ä–æ–≤, –∫–Ω–∏–≥, —á–∏—Ç–∞—Ç–µ–ª–µ–π –∏ –≤—ã–¥–∞—á –∫–Ω–∏–≥, –∞ —Ç–∞–∫–∂–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–∏.

–®–ø–∞—Ä–≥–∞–ª–∫–∞ SQL –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ 307–ª–∏–Ω–∏—è
–ê–≤—Ç–æ—Ä—ã 371 –ª–∏–Ω–∏—è
–ö–Ω–∏–≥–∏ 398 –ª–∏–Ω–∏—è
–ß–∏—Ç–∞—Ç–µ–ª–∏ 445 –ª–∏–Ω–∏—è
–í—ã–¥–∞—á–∏ 473 –ª–∏–Ω–∏—è
–ë–∏–∑–Ω–µ—Å –æ–ø–µ—Ä–∞—Ü–∏–∏ 513 –ª–∏–Ω–∏—è
##  –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

-  –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ **–∫–Ω–∏–≥–∞–º–∏**
- Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ **–∞–≤—Ç–æ—Ä–∞–º–∏**
-  –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ **—á–∏—Ç–∞—Ç–µ–ª—è–º–∏**
-  –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ **–≤—ã–¥–∞—á–∞–º–∏ –∫–Ω–∏–≥**
- Ô∏è –ë–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–∏:
    - –í—ã–¥–∞—á–∞ –∫–Ω–∏–≥–∏ —á–∏—Ç–∞—Ç–µ–ª—é
    - –í–æ–∑–≤—Ä–∞—Ç –∫–Ω–∏–≥–∏
    - –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –≤—ã–¥–∞—á
    - –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤—ã–¥–∞—á
    - –ü–æ–∏—Å–∫ –∫–Ω–∏–≥ –ø–æ –∞–≤—Ç–æ—Ä—É –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏—é



##  –¢–µ–º–∞ –ø—Ä–æ–µ–∫—Ç–∞

**–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π**

–ü–æ–∑–≤–æ–ª—è–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—é:
- –î–æ–±–∞–≤–ª—è—Ç—å –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–∏–≥–∏ –∏ –∞–≤—Ç–æ—Ä–æ–≤
- –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —á–∏—Ç–∞—Ç–µ–ª–µ–π
- –û—Ñ–æ—Ä–º–ª—è—Ç—å –≤—ã–¥–∞—á—É –∏ –≤–æ–∑–≤—Ä–∞—Ç –∫–Ω–∏–≥
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Å—Ä–æ–∫–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞



##  –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Java 17**
- **Spring Boot 3**
- **Spring Web / Data JPA**
- **Hibernate**
- **PostgreSQL** (–æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
- **H2** (in-memory –ë–î –¥–ª—è —Ç–µ—Å—Ç–æ–≤)
- **Swagger / OpenAPI** –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- **Lombok** –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –∫–æ–¥–∞
- **Docker Compose** –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

---

##  –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏

| –°—É—â–Ω–æ—Å—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|-----------|
| **Author** | –ê–≤—Ç–æ—Ä –∫–Ω–∏–≥–∏ (–∏–º—è, –±–∏–æ–≥—Ä–∞—Ñ–∏—è) |
| **Book** | –ö–Ω–∏–≥–∞ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –≥–æ–¥ –∏–∑–¥–∞–Ω–∏—è, –Ω–∞–ª–∏—á–∏–µ, —Å—Å—ã–ª–∫–∞ –Ω–∞ –∞–≤—Ç–æ—Ä–∞) |
| **Reader** | –ß–∏—Ç–∞—Ç–µ–ª—å (–∏–º—è, email, —Ç–µ–ª–µ—Ñ–æ–Ω) |
| **Loan** | –í—ã–¥–∞—á–∞ –∫–Ω–∏–≥–∏ (–∫–Ω–∏–≥–∞, —á–∏—Ç–∞—Ç–µ–ª—å, –¥–∞—Ç—ã –≤—ã–¥–∞—á–∏ –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞) |

###  –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
- `Book` ‚Üí `Author` : Many-to-One
- `Loan` ‚Üí `Book` : Many-to-One
- `Loan` ‚Üí `Reader` : Many-to-One

---

##  –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
- `application-h2.properties` ‚Äî –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `application-postgres.properties` ‚Äî –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL
- `application-supabase.properties` ‚Äî –¥–ª—è –æ–±–ª–∞—á–Ω–æ–π –ë–î (Supabase)

–ê–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–¥–∞—ë—Ç—Å—è –≤ `application.properties`:
```properties
spring.profiles.active=postgres

###

## –°–ë–û–†–ö–ê –ò –ó–ê–ü–£–°–ö –ü–†–û–ï–ö–¢–ê

# –ö–ª–æ–Ω–∏—Ä—É–µ–º –ø—Ä–æ–µ–∫—Ç
git clone https://github.com/akula5561/laba2-rbpo.git
cd laba2-rbpo

# –ó–∞–ø—É—Å–∫ PostgreSQL —á–µ—Ä–µ–∑ Docker
docker-compose up -d

# –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
./mvnw clean package

# –ó–∞–ø—É—Å–∫ Spring Boot –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
./mvnw spring-boot:run

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ API –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É:
 http://localhost:8080/api


–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ (Postman)
 –ê–≤—Ç–æ—Ä
–°–æ–∑–¥–∞—Ç—å –∞–≤—Ç–æ—Ä–∞
–í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
POST /api/authors
{
  "name": "J.K. Rowling",
  "bio": "British writer"
}
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –∞–≤—Ç–æ—Ä–æ–≤
–í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
GET /api/authors
–ò–∑–º–µ–Ω–∏—Ç—å –∞–≤—Ç–æ—Ä–∞
–í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
PUT /api/authors/1
{
  "name": "Joanne Rowling",
  "bio": "Updated bio"
}

 –ö–Ω–∏–≥–∞
–°–æ–∑–¥–∞—Ç—å –∫–Ω–∏–≥—É
–í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
POST /api/books
{
  "title": "Harry Potter and the Philosopher's Stone",
  "publishedYear": 1997,
  "available": true,
  "authorId": 1
}
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–Ω–∏–≥–∏
–í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
GET /api/books
–ù–∞–π—Ç–∏ –∫–Ω–∏–≥–∏ –ø–æ –∞–≤—Ç–æ—Ä—É
–í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
GET /api/books/query/author/1

 –ß–∏—Ç–∞—Ç–µ–ª—å
–°–æ–∑–¥–∞—Ç—å —á–∏—Ç–∞—Ç–µ–ª—è
–í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
POST /api/readers
{
  "name": "Ivan Ivanov",
  "email": "ivan@mail.ru",
  "phone": "+79999999999"
}
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö —á–∏—Ç–∞—Ç–µ–ª–µ–π
–í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
GET /api/readers

 –í—ã–¥–∞—á–∏ (Loan)
–í—ã–¥–∞—Ç—å –∫–Ω–∏–≥—É
–í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
POST /api/loans
{
  "bookId": 1,
  "readerId": 1,
  "loanDate": "2025-11-07",
  "dueDate": "2025-11-14"
}
–í–µ—Ä–Ω—É—Ç—å –∫–Ω–∏–≥—É
–í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
PATCH /api/loans/1/return
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Å—Ä–æ—á–∫–∏
–í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
GET /api/loans/overdue

 –ë–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–∏ (5 –ø—Ä–∏–º–µ—Ä–æ–≤)
1. –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –≤—ã–¥–∞—á–∏ –∫–Ω–∏–≥–∏ (POST /api/loans)
2. –í–æ–∑–≤—Ä–∞—Ç –∫–Ω–∏–≥–∏ (PATCH /api/loans/{id}/return)
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –≤—ã–¥–∞—á (GET /api/loans/overdue)
4. –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –∫–Ω–∏–≥ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –∞–≤—Ç–æ—Ä–∞ (GET /api/books/query/author/{id})
5. –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤—ã–¥–∞—á (GET /api/loans/active)

–ö–æ–ª–ª–µ–∫—Ü–∏—è Postman
–ö–æ–ª–ª–µ–∫—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç:
* CRUD-–∑–∞–ø—Ä–æ—Å—ã –ø–æ –≤—Å–µ–º —Å—É—â–Ω–æ—Å—Ç—è–º
* 5 –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–π
* –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (host, port, basePath=/api)

 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è
 1. –°–æ–∑–¥–∞—Ç—å –∞–≤—Ç–æ—Ä–∞  2. –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É —ç—Ç–æ–º—É –∞–≤—Ç–æ—Ä—É  3. –°–æ–∑–¥–∞—Ç—å —á–∏—Ç–∞—Ç–µ–ª—è  4. –í—ã–¥–∞—Ç—å –∫–Ω–∏–≥—É  5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–¥–∞—á—É –∏ –≤–µ—Ä–Ω—É—Ç—å –∫–Ω–∏–≥—É  6. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–Ω–∏–≥–∞ —Å–Ω–æ–≤–∞ –¥–æ—Å—Ç—É–ø–Ω–∞  7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Å—Ä–æ—á–∫–∏
 
 

 –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö PostgreSQL
 –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL

psql -U postgres
–ï—Å–ª–∏ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å Postgres.app (–Ω–∞ macOS), –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä–æ–π –µ—ë –∏ –≤–≤–µ–¥–∏:

psql -p5432 -U danilparfenov

 –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

-- –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
CREATE DATABASE library;

-- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –µ–≥–æ –µ—â—ë –Ω–µ—Ç)
CREATE ROLE library WITH LOGIN PASSWORD 'library';

-- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∞–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
GRANT ALL PRIVILEGES ON DATABASE library TO library;

 –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –Ω—É–∂–Ω–æ–π –ë–î

\c library

 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –∏ —Å—Ö–µ–º—ã

-- –†–∞–∑—Ä–µ—à–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–æ—Å—Ç—É–ø –∫ —Å—Ö–µ–º–µ public
GRANT ALL ON SCHEMA public TO library;

-- –î–∞—ë–º –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
ALTER DEFAULT PRIVILEGES IN SCHEMA public
GRANT ALL ON TABLES TO library;

ALTER DEFAULT PRIVILEGES IN SCHEMA public
GRANT ALL ON SEQUENCES TO library;

 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü

\dt
–í—ã–≤–æ–¥ –ø–æ–∫–∞–∂–µ—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä:

 public | authors | table | library
 public | books   | table | library
 public | loans   | table | library
 public | readers | table | library

 –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ

SELECT * FROM authors;
SELECT * FROM books;
SELECT * FROM readers;
SELECT * FROM loans;

 –ü—Ä–∏–º–µ—Ä—ã SQL-–∑–∞–ø—Ä–æ—Å–æ–≤

-- –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Ä–∞
INSERT INTO authors (name, bio)
VALUES ('J.K. Rowling', 'British writer');

-- –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É
INSERT INTO books (title, published_year, available, author_id)
VALUES ('Harry Potter and the Chamber of Secrets', 1998, true, 1);

-- –î–æ–±–∞–≤–∏—Ç—å —á–∏—Ç–∞—Ç–µ–ª—è
INSERT INTO readers (name, email, phone)
VALUES ('Ivan Ivanov', 'ivan@mail.ru', '+79999999999');

-- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—ã–¥–∞—á—É –∫–Ω–∏–≥–∏
INSERT INTO loans (book_id, reader_id, loan_date, due_date)
VALUES (1, 1, CURRENT_DATE, CURRENT_DATE + INTERVAL '7 day');

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –≤—ã–¥–∞—á–∏
SELECT * FROM loans WHERE due_date < CURRENT_DATE AND return_date IS NULL;

 –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã psql
–ö–æ–º–∞–Ω–¥–∞	–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
\l	 –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
\c db_name	–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î
\dt	 –ü–æ–∫–∞–∑–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã
\d table_name	 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã
\du	 –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
\q	 –í—ã–π—Ç–∏ –∏–∑ psql

 –£–¥–∞–ª–µ–Ω–∏–µ –ë–î –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

DROP DATABASE library;
DROP ROLE library;

## –ó–∞–¥–∞–Ω–∏–µ 4

–í —ç—Ç–æ–º –∑–∞–¥–∞–Ω–∏–∏ —è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª –±–∞–∑–æ–≤—É—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å REST-API –Ω–∞ Spring Security.

–í–æ-–ø–µ—Ä–≤—ã—Ö, —è –ø–æ–¥–∫–ª—é—á–∏–ª spring-boot-starter-security –∏ –Ω–∞—Å—Ç—Ä–æ–∏–ª SecurityConfig.
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—Å–µ –∫–æ–Ω–µ—á–Ω—ã–µ —Ç–æ—á–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∑–∞–∫—Ä—ã—Ç—ã –∏ —Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Basic Auth.

–í–æ-–≤—Ç–æ—Ä—ã—Ö, —è –¥–æ–±–∞–≤–∏–ª –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—É—â–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è UserAccount —Å –ø–æ–ª—è–º–∏ username, password –∏ role.
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –∞ –Ω–µ –≤ –∫–æ–¥–µ. –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–∏–º —è —Å–¥–µ–ª–∞–ª UserAccountRepository –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª CustomUserDetailsService, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î –≤ —Ñ–æ—Ä–º–∞—Ç–µ UserDetails –¥–ª—è Spring Security.

–¢–∞–∫–∂–µ —è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ –æ—Ç–∫—Ä—ã—Ç—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç POST /api/auth/register.
–¢–∞–º –∏–¥—ë—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞: –ª–æ–≥–∏–Ω –Ω–µ –ø—É—Å—Ç–æ–π, –ª–æ–≥–∏–Ω —É–Ω–∏–∫–∞–ª–µ–Ω –∏ –ø–∞—Ä–æ–ª—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞–¥—ë–∂–Ω—ã–π ‚Äî –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤, —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –±—É–∫–≤–∞ –∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞. –ü–∞—Ä–æ–ª—å –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ö—ç—à–∏—Ä—É–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é BCryptPasswordEncoder, –ø–æ—ç—Ç–æ–º—É –≤ –±–∞–∑–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ö—ç—à, –∞ –Ω–µ –æ—Ç–∫—Ä—ã—Ç—ã–π —Ç–µ–∫—Å—Ç.

–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ —Ä–æ–ª—è–º.
–û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ä–æ–ª—å—é USER –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ CRUD-–æ–ø–µ—Ä–∞—Ü–∏—è–º –¥–ª—è –∞–≤—Ç–æ—Ä–æ–≤, –∫–Ω–∏–≥, —á–∏—Ç–∞—Ç–µ–ª–µ–π –∏ –≤—ã–¥–∞—á (/authors, /books, /readers, /loans).
–ê–¥–º–∏–Ω—Å–∫–∏–µ –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ –≤—ã–¥–∞—á–∞–º –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ /loans/ops/** –∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ —Ä–æ–ª–∏ ADMIN.
–î–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 401 Unauthorized, –∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö, –Ω–æ –±–µ–∑ –Ω—É–∂–Ω–æ–π —Ä–æ–ª–∏ ‚Äî 403 Forbidden.

CSRF —è –æ—Ç–∫–ª—é—á–∏–ª, –ø–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ —á–∏—Å—Ç–æ–µ REST-API, –±–µ–∑ —Ñ–æ—Ä–º –∏ cookie-—Å–µ—Å—Å–∏–π, –∏ —Ç–æ–∫–µ–Ω CSRF –∑–¥–µ—Å—å –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.
–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤ –ø—Ä–æ–µ–∫—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ —Ä–æ–ª—è–º, –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–æ—Å—Ç—É–ø–∞.
 
–õ–∞–±–∞ 5 

##–í —Ä–∞–º–∫–∞—Ö –ø—è—Ç–æ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —è –ø–µ—Ä–µ–≤—ë–ª –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —Å Basic Auth –Ω–∞ JWT —Å –ø–∞—Ä–æ–π access/refresh —Ç–æ–∫–µ–Ω–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —Å–µ—Å—Å–∏—è–º–∏.

–ü—Ä–∏ –ª–æ–≥–∏–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å POST /api/auth/login —Å –ª–æ–≥–∏–Ω–æ–º –∏ –ø–∞—Ä–æ–ª–µ–º. –°–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ AuthenticationManager –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏, –µ—Å–ª–∏ –≤—Å—ë —Ö–æ—Ä–æ—à–æ, —Å –ø–æ–º–æ—â—å—é JwtTokenProvider –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–≤–∞ —Ç–æ–∫–µ–Ω–∞: –∫–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏–π access-token –∏ –±–æ–ª–µ–µ –¥–æ–ª–≥–∏–π refresh-token.
Access-token —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ä–æ–ª–∏, –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ Authorization: Bearer <access> –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞—â–∏—â—ë–Ω–Ω—ã–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º, –Ω–∞–ø—Ä–∏–º–µ—Ä /books. Refresh-token —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ —Ç–∞–±–ª–∏—Ü–µ user_sessions –∏ —Å–ª—É–∂–∏—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä—ã —Ç–æ–∫–µ–Ω–æ–≤.

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Å—Å–∏—è–º–∏ —è –¥–æ–±–∞–≤–∏–ª —Å—É—â–Ω–æ—Å—Ç—å UserSession –∏ enum SessionStatus —Å —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ ACTIVE, USED –∏ REVOKED. –ü—Ä–∏ –ª–æ–≥–∏–Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ user_sessions —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º ACTIVE, –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏ access –∏ refresh —Ç–æ–∫–µ–Ω–∞ –∏ —Å–∞–º–∏–º refresh-—Ç–æ–∫–µ–Ω–æ–º.
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä—ã —Ç–æ–∫–µ–Ω–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç POST /api/auth/refresh. –ö–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ–¥–∞—ë—Ç —Ç—É–¥–∞ refresh-token, —Å–µ—Ä–≤–∏—Å UserSessionService –ø–æ –Ω–µ–º—É –Ω–∞—Ö–æ–¥–∏—Ç —Å–µ—Å—Å–∏—é, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∏ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è, –ø–æ–º–µ—á–∞–µ—Ç —Å—Ç–∞—Ä—É—é —Å–µ—Å—Å–∏—é –∫–∞–∫ USED –∏ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º ACTIVE –∏ –Ω–æ–≤–æ–π –ø–∞—Ä–æ–π —Ç–æ–∫–µ–Ω–æ–≤. –ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É –æ–¥–∏–Ω refresh-—Ç–æ–∫–µ–Ω –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–≤–∞ —Ä–∞–∑–∞ ‚Äî –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –æ—à–∏–±–∫–µ.

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ access-—Ç–æ–∫–µ–Ω–∞ —è –¥–æ–±–∞–≤–∏–ª —Ñ–∏–ª—å—Ç—Ä JwtAuthenticationFilter, –∫–æ—Ç–æ—Ä—ã–π —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å: –æ–Ω —á–∏—Ç–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ Authorization, –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω –∏, –µ—Å–ª–∏ –æ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Authentication –≤ SecurityContext. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –≤ stateless-—Ä–µ–∂–∏–º, CSRF –æ—Ç–∫–ª—é—á—ë–Ω, –∞ –¥–æ—Å—Ç—É–ø –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω –ø–æ —Ä–æ–ª—è–º: –æ–±—ã—á–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –∞ –∞–¥–º–∏–Ω—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ –≤—ã–¥–∞—á–∞–º ‚Äî —Ç–æ–ª—å–∫–æ —Ä–æ–ª–∏ ADMIN.

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞: –ª–æ–≥–∏–Ω ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä—ã —Ç–æ–∫–µ–Ω–æ–≤ ‚Üí –¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å–∞–º –ø–æ access-—Ç–æ–∫–µ–Ω—É ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä—ã –ø–æ refresh-—Ç–æ–∫–µ–Ω—É —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º —Å–µ—Å—Å–∏–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.


-- –®–ø–∞—Ä–≥–∞–ª–∫–∞ SQL –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

-- –ü–æ–∫–∞–∑–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã
\dt;

-- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã
-- \d books;

-- –í—Å–µ –∞–≤—Ç–æ—Ä—ã
SELECT * FROM authors ORDER BY id;

-- –í—Å–µ –∫–Ω–∏–≥–∏
SELECT * FROM books ORDER BY id;

-- –í—Å–µ —á–∏—Ç–∞—Ç–µ–ª–∏
SELECT * FROM readers ORDER BY id;

-- –í—Å–µ –≤—ã–¥–∞—á–∏
SELECT * FROM loans ORDER BY id;

-- –î–∂–æ–π–Ω—ã –≤—ã–¥–∞—á
SELECT l.id, r.name AS reader, b.title AS book, l.issue_date, l.due_date, l.returned_at
FROM loans l
JOIN readers r ON l.reader_id = r.id
JOIN books b ON l.book_id = b.id;

-- –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –≤—ã–¥–∞—á–∏
SELECT l.id, r.name, b.title, l.due_date
FROM loans l
JOIN readers r ON l.reader_id = r.id
JOIN books b ON l.book_id = b.id
WHERE l.returned_at IS NULL AND l.due_date < NOW();

-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ security
SELECT id, username, role FROM users ORDER BY id;

-- –°–¥–µ–ª–∞—Ç—å –∞–¥–º–∏–Ω–æ–º
-- UPDATE users SET role='ADMIN' WHERE username='user1';

-- –°–µ—Å—Å–∏–∏ JWT
SELECT id, username, status, access_token_expiry, refresh_token_expiry
FROM user_sessions ORDER BY access_token_expiry;

-- –û—á–∏—Å—Ç–∏—Ç—å —Å–µ—Å—Å–∏–∏
-- DELETE FROM user_sessions;

–ú–ï–¢–û–î /url ‚Äî —á—Ç–æ –¥–µ–ª–∞–µ—Ç (–∫—Ç–æ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø)

üß∑ Auth / –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

POST /api/auth/register
‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ª–æ–≥–∏–Ω + –ø–∞—Ä–æ–ª—å ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ users, –ø–∞—Ä–æ–ª—å —Ö—ç—à–∏—Ä—É–µ—Ç—Å—è).
–î–æ—Å—Ç—É–ø: –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (permitAll).

POST /api/auth/login
‚Äî –ª–æ–≥–∏–Ω –ø–æ username –∏ password.
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON:
{ "accessToken": "...", "refreshToken": "..." }
–î–æ—Å—Ç—É–ø: –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

POST /api/auth/refresh
‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ—Ç refreshToken, –µ—Å–ª–∏ –æ–Ω –∞–∫—Ç–∏–≤–µ–Ω –∏ –Ω–µ –∏—Å—Ç—ë–∫ ‚Üí –≤—ã–¥–∞—ë—Ç –Ω–æ–≤—É—é –ø–∞—Ä—É access + refresh, –ø–æ–º–µ—á–∞–µ—Ç —Å—Ç–∞—Ä—É—é —Å–µ—Å—Å–∏—é –∫–∞–∫ USED –∏ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –≤ user_sessions.
–î–æ—Å—Ç—É–ø: –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–Ω–æ –Ω—É–∂–µ–Ω –≤–∞–ª–∏–¥–Ω—ã–π refresh).

–ê–≤—Ç–æ—Ä—ã (AuthorController)

GET /authors
‚Äî –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –∞–≤—Ç–æ—Ä–æ–≤.
–î–æ—Å—Ç—É–ø: –ª—é–±–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (USER/ADMIN).

GET /authors/{id}
‚Äî –ø–æ–ª—É—á–∏—Ç—å –∞–≤—Ç–æ—Ä–∞ –ø–æ id.
–î–æ—Å—Ç—É–ø: USER/ADMIN.

GET /authors/page
‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–≤—Ç–æ—Ä–æ–≤ (–ø–∞–≥–∏–Ω–∞—Ü–∏—è).
–î–æ—Å—Ç—É–ø: USER/ADMIN.

POST /authors
‚Äî —Å–æ–∑–¥–∞—Ç—å –∞–≤—Ç–æ—Ä–∞.
–î–æ—Å—Ç—É–ø: USER/ADMIN (–æ–±—ã—á–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è).

PUT /authors/{id}
‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∞.
–î–æ—Å—Ç—É–ø: USER/ADMIN.

DELETE /authors/{id}
‚Äî —É–¥–∞–ª–∏—Ç—å –∞–≤—Ç–æ—Ä–∞.
–î–æ—Å—Ç—É–ø: USER/ADMIN (–º–æ–∂–Ω–æ –≥–æ–≤–æ—Ä–∏—Ç—å, —á—Ç–æ –æ–±—ã—á–Ω–æ —ç—Ç–æ –∞–¥–º–∏–Ω—Å–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è, –Ω–æ –≤ –∑–∞–¥–∞–Ω–∏–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–æ–ª–∏ USER/ADMIN).

–ö–Ω–∏–≥–∏ (BookController)

GET /books
‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–Ω–∏–≥.
–î–æ—Å—Ç—É–ø: USER/ADMIN.

GET /books/{id}
‚Äî –ø–æ–ª—É—á–∏—Ç—å –∫–Ω–∏–≥—É –ø–æ id.
–î–æ—Å—Ç—É–ø: USER/ADMIN.

GET /books/page
‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–Ω–∏–≥ (–ø–∞–≥–∏–Ω–∞—Ü–∏—è).
–î–æ—Å—Ç—É–ø: USER/ADMIN.

POST /books
‚Äî —Å–æ–∑–¥–∞—Ç—å –∫–Ω–∏–≥—É.
–î–æ—Å—Ç—É–ø: USER/ADMIN.

PUT /books/{id}
‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –∫–Ω–∏–≥—É.
–î–æ—Å—Ç—É–ø: USER/ADMIN.

DELETE /books/{id}
‚Äî —É–¥–∞–ª–∏—Ç—å –∫–Ω–∏–≥—É.
–î–æ—Å—Ç—É–ø: USER/ADMIN.

GET /books/available
‚Äî –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–Ω–∏–≥–∏.
–î–æ—Å—Ç—É–ø: USER/ADMIN.

PATCH /books/{id}/borrow
‚Äî –ø–æ–º–µ—Ç–∏—Ç—å –∫–Ω–∏–≥—É –∫–∞–∫ –≤—ã–¥–∞–Ω–Ω—É—é (–æ–±—ã—á–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è, –µ—Å–ª–∏ —Ç–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ).
–î–æ—Å—Ç—É–ø: USER/ADMIN.

PATCH /books/{id}/return
‚Äî –≤–µ—Ä–Ω—É—Ç—å –∫–Ω–∏–≥—É.
–î–æ—Å—Ç—É–ø: USER/ADMIN.

GET /books/search?q=... –∏–ª–∏ —á—Ç–æ-—Ç–æ –≤ —ç—Ç–æ–º –¥—É—Ö–µ
‚Äî –ø–æ–∏—Å–∫ –∫–Ω–∏–≥ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é.
–î–æ—Å—Ç—É–ø: USER/ADMIN.

GET /books/query/author/{authorId}
‚Äî –≤—Å–µ –∫–Ω–∏–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–≤—Ç–æ—Ä–∞.
–î–æ—Å—Ç—É–ø: USER/ADMIN.

–ß–∏—Ç–∞—Ç–µ–ª–∏ (ReaderController)

GET /readers
‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —á–∏—Ç–∞—Ç–µ–ª–µ–π.
–î–æ—Å—Ç—É–ø: USER/ADMIN.

GET /readers/{id}
‚Äî –æ–¥–∏–Ω —á–∏—Ç–∞—Ç–µ–ª—å –ø–æ id.
–î–æ—Å—Ç—É–ø: USER/ADMIN.

GET /readers/page
‚Äî –ø–∞–≥–∏–Ω–∞—Ü–∏—è —á–∏—Ç–∞—Ç–µ–ª–µ–π.
–î–æ—Å—Ç—É–ø: USER/ADMIN.

POST /readers
‚Äî —Å–æ–∑–¥–∞—Ç—å —á–∏—Ç–∞—Ç–µ–ª—è.
–î–æ—Å—Ç—É–ø: USER/ADMIN.

PUT /readers/{id}
‚Äî –æ–±–Ω–æ–≤–∏—Ç—å —á–∏—Ç–∞—Ç–µ–ª—è.
–î–æ—Å—Ç—É–ø: USER/ADMIN.

DELETE /readers/{id}
‚Äî —É–¥–∞–ª–∏—Ç—å —á–∏—Ç–∞—Ç–µ–ª—è.
–î–æ—Å—Ç—É–ø: USER/ADMIN.


–í—ã–¥–∞—á–∏ (–æ–±—ã—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, LoanController)

GET /loans
‚Äî –≤—Å–µ –≤—ã–¥–∞—á–∏.
–î–æ—Å—Ç—É–ø: USER/ADMIN.

GET /loans?active=true
‚Äî —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –≤—ã–¥–∞—á–∏.
–î–æ—Å—Ç—É–ø: USER/ADMIN.

GET /loans?active=false
‚Äî —Ç–æ–ª—å–∫–æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ.
–î–æ—Å—Ç—É–ø: USER/ADMIN.

GET /loans/{id}
‚Äî –≤—ã–¥–∞—á–∞ –ø–æ id.
–î–æ—Å—Ç—É–ø: USER/ADMIN.

POST /loans
‚Äî —Å–æ–∑–¥–∞—Ç—å –≤—ã–¥–∞—á—É (–∫–Ω–∏–≥–∞+—á–∏—Ç–∞—Ç–µ–ª—å+—Å—Ä–æ–∫).
–î–æ—Å—Ç—É–ø: USER/ADMIN.

PATCH /loans/{id}/return
‚Äî –≤–µ—Ä–Ω—É—Ç—å –∫–Ω–∏–≥—É –ø–æ –≤—ã–¥–∞—á–µ.
–î–æ—Å—Ç—É–ø: USER/ADMIN.

GET /loans/reader/{readerId}
‚Äî –≤—Å–µ –≤—ã–¥–∞—á–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–∏—Ç–∞—Ç–µ–ª—è.
–î–æ—Å—Ç—É–ø: USER/ADMIN.

GET /loans/overdue
‚Äî –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –≤—ã–¥–∞—á–∏ (–æ–±—ã—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å).
–î–æ—Å—Ç—É–ø: USER/ADMIN.

GET /loans/{id}/fine
‚Äî —Ä–∞—Å—á—ë—Ç —à—Ç—Ä–∞—Ñ–∞ –ø–æ –≤—ã–¥–∞—á–µ.
–î–æ—Å—Ç—É–ø: USER/ADMIN.


–ë–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–∏ (–∞–¥–º–∏–Ω—Å–∫–∏–µ, LoanBusinessController)

–í—Å–µ –ø–æ–¥ –ø—Ä–µ—Ñ–∏–∫—Å–æ–º /loans/ops/**, –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ ADMIN:

POST /loans/ops/borrow
‚Äî –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏—è –ø–æ –≤—ã–¥–∞—á–µ –∫–Ω–∏–≥–∏ (—É—á–∏—Ç—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–∏–≥–∏, —á–∏—Ç–∞—Ç–µ–ª—è –∏ —Ç.–¥.).

PATCH /loans/ops/{loanId}/return
‚Äî –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤—ã–¥–∞—á—É, –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è).

PATCH /loans/ops/{loanId}/extend?days=7 (–µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
‚Äî –ø—Ä–æ–¥–ª–∏—Ç—å —Å—Ä–æ–∫ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ N –¥–Ω–µ–π.

GET /loans/ops/overdue
‚Äî —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –≤—ã–¥–∞—á —Å –ª–æ–≥–∏–∫–æ–π –∏–º–µ–Ω–Ω–æ –¥–ª—è –∞–¥–º–∏–Ω–∞.

—á–µ–º –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –æ–±—ã—á–Ω—ã–µ /loans –∏ /loans/ops:

/loans ‚Äî —ç—Ç–æ –æ–±—ã—á–Ω—ã–µ CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏,
–∞ /loans/ops ‚Äî –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –∏ –æ–Ω–∏ –∑–∞—â–∏—â–µ–Ω—ã —Ä–æ–ª—å—é ADMIN.


–ü–µ—Ä–µ–≤—ë–ª –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –Ω–∞ JWT:

–ø—Ä–∏ –ª–æ–≥–∏–Ω–µ (POST /api/auth/login) —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å;

–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–≤–∞ —Ç–æ–∫–µ–Ω–∞: access –∏ refresh;

–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ö –≤ JSON.

Access-—Ç–æ–∫–µ–Ω:

–∂–∏–≤—ë—Ç ~15 –º–∏–Ω—É—Ç;

–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ Authorization: Bearer <token>;

–≤–Ω—É—Ç—Ä–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–∏–Ω –∏ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

Refresh-—Ç–æ–∫–µ–Ω:

–∂–∏–≤—ë—Ç –¥–æ–ª—å—à–µ (–Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π);

—Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ —Ç–∞–±–ª–∏—Ü–µ user_sessions;

–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ POST /api/auth/refresh.

–î–æ–±–∞–≤–∏–ª —Å—É—â–Ω–æ—Å—Ç—å UserSession –∏ SessionStatus:

ACTIVE ‚Äî —Ç–æ–∫–µ–Ω –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å;

USED ‚Äî —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è;

REVOKED ‚Äî –æ—Ç–æ–∑–≤–∞–Ω.
–ü—Ä–∏ –ª–æ–≥–∏–Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å user_sessions —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º ACTIVE, –ø—Ä–∏ refresh —Å—Ç–∞—Ä–∞—è –ø–æ–º–µ—á–∞–µ—Ç—Å—è USED, —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è ACTIVE.

–°–¥–µ–ª–∞–ª —Ñ–∏–ª—å—Ç—Ä JwtAuthenticationFilter:

–Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ Authorization: Bearer ...;

–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω;

–ø–æ–¥–Ω–∏–º–∞–µ—Ç Authentication –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ Spring Security.

SecurityConfig –ø–µ—Ä–µ–≤–µ–¥—ë–Ω –≤ stateless:

sessionCreationPolicy(STATELESS);

CSRF –æ—Ç–∫–ª—é—á—ë–Ω, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–∏—Å—Ç—ã–π JWT –∏ –Ω–µ—Ç —Å–µ—Å—Å–∏–æ–Ω–Ω—ã—Ö cookie.

–†–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—Ä–∞–≤ –ø–æ —Ä–æ–ª—è–º –æ—Å—Ç–∞–ª–æ—Å—å:

–¥–ª—è USER/ADMIN –≤—Å—ë –∫–∞–∫ –≤ 4-–π –ª–∞–±–µ;

—Ç–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–± –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–º–µ–Ω–∏–ª—Å—è –Ω–∞ JWT.

–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:

–°—Ü–µ–Ω–∞—Ä–∏–π 1 (–∏–∑ –º–µ—Ç–æ–¥–∏—á–∫–∏):

POST /api/auth/login ‚Üí –ø–æ–ª—É—á–∏—Ç—å accessToken + refreshToken.

GET /books c Authorization: Bearer <access> ‚Üí 200 OK.

POST /api/auth/refresh c refreshToken ‚Üí –Ω–æ–≤–∞—è –ø–∞—Ä–∞ —Ç–æ–∫–µ–Ω–æ–≤.

–ü–æ–≤—Ç–æ—Ä–∏—Ç—å POST /api/auth/refresh —Å–æ —Å—Ç–∞—Ä—ã–º refresh ‚Üí –æ—à–∏–±–∫–∞, —Ç.–∫. —Å—Ç–∞—Ç—É—Å —Å–µ—Å—Å–∏–∏ —É–∂–µ USED.

–ü–æ–∫–∞–∑–∞—Ç—å –≤ –ë–î SELECT * FROM user_sessions;:

–ø–µ—Ä–≤–∞—è —Å–µ—Å—Å–∏—è ‚Üí USED,

–≤—Ç–æ—Ä–∞—è ‚Üí ACTIVE.

–°—Ü–µ–Ω–∞—Ä–∏–π 2 (—Ä–æ–ª–∏ + JWT):

–õ–æ–≥–∏–Ω –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –ø–æ–ª—É—á–∏—Ç—å access.

GET /books —Å —ç—Ç–∏–º access ‚Üí 200.

GET /loans/ops/overdue —Å —ç—Ç–∏–º –∂–µ access ‚Üí 403 (–Ω–µ—Ç –ø—Ä–∞–≤).

–í –ë–î —Å–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å –Ω–∞ ADMIN (UPDATE users SET role='ADMIN' WHERE username='user1';).

–°–Ω–æ–≤–∞ –ª–æ–≥–∏–Ω ‚Üí –Ω–æ–≤—ã–π access, —Ç–µ–ø–µ—Ä—å GET /loans/ops/overdue ‚Üí 200.